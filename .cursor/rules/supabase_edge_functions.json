{
  "description": "Supabase Edge Functions Best Practices",
  "globs": ["apps/api/supabase/functions/**"],
  "rules": {
    "General Guidelines": [
      "Use Web APIs and Denoâ€™s core APIs instead of external dependencies (e.g., use fetch instead of Axios, use WebSockets API instead of node-ws).",
      "If reusing utility methods between Edge Functions, add them to 'supabase/functions/_shared' and import using a relative path. Do NOT create cross dependencies between Edge Functions.",
      "Do NOT use bare specifiers when importing dependencies. Prefix them with either 'npm:' or 'jsr:'. For example, use 'npm:@supabase/supabase-js'.",
      "For external imports, always define a version. For example, 'npm:@express' should be written as 'npm:express@4.18.2'.",
      "For external dependencies, prefer importing via 'npm:' and 'jsr:'. Minimize the use of 'deno.land/x', 'esm.sh', and 'unpkg.com'.",
      "If a package is from 'deno.land/x', 'esm.sh', or 'unpkg.com', replace the CDN hostname with the 'npm:' specifier where possible.",
      "Node built-in APIs can be used, but must be imported using 'node:' specifier. For example: 'import process from \"node:process\"'.",
      "Do NOT use 'import { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"'. Instead, use the built-in 'Deno.serve'."
    ],
    "Environment Variables": [
      "The following environment variables are pre-populated in both local and hosted Supabase environments: SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY, SUPABASE_DB_URL.",
      "To set other environment variables, users should use an environment file and run 'supabase secrets set --env-file path/to/env-file'."
    ],
    "Best Practices": [
      "Ensure Edge Functions are stateless and optimized for performance.",
      "Avoid blocking operations and use async/await where applicable.",
      "Use structured logging and include useful metadata in logs.",
      "Use error boundaries and handle potential failures gracefully.",
      "Follow Supabase documentation for API integration and best practices."
    ],
    "Example Templates": {
      "Simple Hello World Function": [
        "Use Deno.serve for serving requests.",
        "Expect JSON payloads and validate input before processing.",
        "Return JSON responses with appropriate headers."
      ],
      "Using Node Built-in APIs": [
        "Use 'node:' specifier when importing Node APIs.",
        "Ensure compatibility with the Deno runtime."
      ],
      "Using npm Packages": [
        "Import npm packages using 'npm:' prefix with versioning.",
        "Ensure compatibility with Edge Functions."
      ],
      "Generating Embeddings with Supabase.ai": [
        "Use 'Supabase.ai.Session' for embeddings.",
        "Follow best practices for processing and caching results."
      ]
    }
  }
}
